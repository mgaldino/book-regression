--- 
title: "Introdução à Regresssão para Ciências Sociais"
author: "Manoel Galdino"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---

# Prefácio

Esse livro é, por enquanto, apenas uma repositório de notas de aula do curso de graduação da Ciências Sociais da USP, FLP xx Métodos e Técnicas de Pesquia IV, de introdução à regressão.


<!--chapter:end:index.Rmd-->

# Revisão de R

---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R e Rstudio

O R é uma linguagem de programação voltada para análise de dados. O Rstudio é uma IDE (interface de desenvolvimento), que nos ajuda a programar em R. No curso utilizaremos o Rstudio para facilitar programar em R.

Normalmente, iremos escrever um comando aqui no Script, clicar em executar (run) ou apertar ctrl + enter, e o Rstudio vai copiar o comando, colar no console e executá-los para nós.

## R como calculadora

o R pode funcionar como calculadora.


```{r, results='asis', message=FALSE}
2+2
3*4
10/2
```

## Objetos no R

Tudo no R é um objeto. Isso significa que um número é um objeto.

```{r, results='asis', message=FALSE}
pi
```

Isso significa que funções (comandos) também são objetos

```{r, results='asis', message=FALSE}
sum(c(1,2,3))
sum
```

E nós podemos criar nossos próprios objetos, dando os nomes que quisermos (exceto se já existe um objeto no R com aquele nome, como por exemplo o objeto "sum").

```{r, results='asis', message=FALSE}
x <- 3
y <- 7
x+y
```

## Tipos de objetos

O R tem muitos tipos de objetos. Vamos listar aqui apenas os mais básicos.

### Numeric

Objetos do tipo numeric são ... números ("reais").

```{r, results='asis', message=FALSE}
# Exemplos
pi
1/3
4
```

### character

Objetos do tipo character são do tipo texto. Sempre são escritos entre aspas (simples ou duplas, tanto faz)

```{r, results='asis', message=FALSE}
# Exemplos
"Manoel Galdino"
'abc'
"7"
```

## Armazenando dados

Para armazenar dados, usualmente teremos 4 tipos de objetos: 1. vetor, 2. Matriz. 3. data.frame, 4. lista. Não vou falar de lista agora (nem de array, que é uma generalização da matriz para mais de duas dimensões).

### Vetor
Um vetor é uma sequência de objetos.

```{r, results='asis', message=FALSE}
# Exemplos
c(1,2,3)
1:3
c("Manoel", "Hugo", "Lia", "Juliana", "Jéssica")
c(c(1,2,3), c(2,3,1))
```

os elementos de um vetor devem ser todos do mesmo tipo:
```{r, results='asis', message=FALSE}
# Exemplos
x <- c("1", 1)
x[2]
# sedundo elemento fica armazenado como character

# não é possível somar texto
x[2] + x[2] # erro
```

### Matriz

Uma matriz são vetores organizados por coluna, todas as colunas (vetores) só podem ser de um tipo, ou seja, não posso ter uma coluna numeric e outra de character, por exemplo.

```{r, results='asis', message=FALSE}
# Exemplos
matrix(1:6, nrow=3, ncol=2)
```

### Data Frame
O data.frame é uma tabela/planilha, e é onde normalmente armazenamos nossos bancos de dados no R.


```{r, results='asis', message=FALSE}
# Exemplos
data.frame(x=1:3, y=c("a", "b", "c"))
```


#### datas
```{r, results='asis', message=FALSE}
## explicando data rapidamente
data_ex <- "2020-10-23"
data_ex1 <- as.Date(data_ex)

data_ex1 + 0:9
## fim da explicação rápida de data
```

```{r, results='asis', message=FALSE}
## criando data de forma repetitiva e tediosa. O que queremos evitar!
minha_data <- c(as.Date('2009-01-01'), as.Date('2009-01-02'), as.Date('2009-01-03'),
  as.Date('2009-01-04'), as.Date('2009-01-05'), as.Date('2009-01-06'),
  as.Date('2009-01-07'), as.Date('2009-01-08'), as.Date('2009-01-09'),
  as.Date('2009-01-10'))

acoes <- data_frame(
  tempo = minha_data,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)

print(acoes)

# criando data.frame de maneira mais inteligente
acoes <- data_frame(
  tempo = as.Date('2009-01-01') + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)

print(acoes)
```

 
## Bibliotecas/pacotes

O R permite que a gente importe comandos que não vêm por padrão no R. Em gerla esses comandos es~toa agrupados sob um pacote. PAra usar esses comandos, primeiro a gente instala o pacote, e depois carrega a biblioteca.

```{r}
# Exemplos
#install.packages("data.table")
#library(data.table)
```

## importando dados
Para importar dados, vamos usar a bilioteca "data.table"
Então, instalem ela se ainda não instalaram (usando o comando install.packages("data.table"))
E depois carreguem a biblioteca: library(data.table)

Para importar, usaremos o comando fread do pacote data.table.

```{r}
# vamos carregar base de dados do ibge
# install.packages("devtools")
# devtools::install_github("tbrugz/ribge")

library(ribge)

# para descobrir quais funções existem nesse pacote, podemos usar:
??ribge
```

<!--chapter:end:02-revisão-R.Rmd-->

# Revisão de estatística e probabilidade

A média de um conjunto de valores é dada pela soma dos valores, dividdo pelo número de observações. Matematicamente:
$media = \sum_{i=1}^n{x_i}/n$ para observações $\{ x_1, x_2, x_3, ..., x_n \}$

Em geral, as observações são uma amostra, e falamos de média amostral, $\overline x$. Ou seja:

$\overline x = \sum_{i=1}^n{x_i}/n$

Exercício 1. Vamos calcular, no R, a média das seguintes amostras:

a) $\{1,2,3,4,5,6,7,8,9,10\}$

b) $\{5,5,5,5,5,5,5\}$

c) $\{1,3,5,7,9,11\}$

d) $\{-5,-4,-3,-2,-1,1,2,3,4,5\}$

Código no R

```{r }
x <- c(1,2,3,4,5,6,7,8,9,10)
(media_x <- sum(x)/length(x))

x <- c(5,5,5,5,5,5,5)
(media_x <-  sum(x)/length(x))

x <- c(1,3,5,7,9,11)
(media_x <-  sum(x)/length(x))

x <- c(-5,-4,-3,-2,-1,1,2,3,4,5)
(media_x <-  sum(x)/length(x))

# ou podemos simplemsnte usar mean(x)
mean(x)
```



## Variável Aleatória

Uma variável aleatória (v.a.) é uma função que mapeia eventos (aleatórios) de um espaço amostral aos números reais, em geral uma probabilidade entre $0$ e $1$. Por exemplo, um dado de $6$ faces possui um espaço amostral de eventos possíveis dados pelos números $\{1,2,3,4,5,6\}$ e cada evento pode sair com uma probabiidade, por exemplo, $1/6$.

## Esperança matemática
A esperança de uma variável aleatória discreta $X$, cuja probabilidade de massa de $x \in X$ é dada por $p(x)$, é definida por: $\sum(x*p(x))$.

A esperança de uma v.a. contínua X, cuja densidade é $f(x)$, é definida por: $\int f(x)*x\,dx$.

Similarmente, para a mesma v.a. X acima, a esperança de uma função $h(X)$ é dada por  $\int f(x)*h(x)\,dx$ e analogamente para o caso discreto.

## Variância

A variância de uma variável aleatória $X$ é dada por:

Definição 1. $Var(X) = \mathbb{E}[(X - \mathbb{E}[X])^2]$.

A Covariância de duas v.a. $X$ e $Y$ é definida como:
$Cov(X,Y) = \mathbb{E}[(X -  \mathbb{E}[X])*(Y -  \mathbb{E}[Y])]$.

Notem que $Cov(X,X) = Var(X)$.

A covariância é positiva quando ambos X e Y tendem a ter valores acima (ou abaixo) de sua média simultaneamente, enquanto ela é negativa quando uma v.a. tende a ter valores acima da sua média e a outra abaixo.

## Algebra com Esperança, Variância e Covariância

Sejam $a$ e $b$ constantes.

1.  Linearidade da Esperença
$\mathbb{E}[aX + bY] =\mathbb{E}[aX] + \mathbb{E}[by] =  a*\mathbb{E}[X] + b*\mathbb{E}[Y]$

Exercício: verifique, com exemplos, que isso é verdade.

2. Identidade da variância
 $Var(X) = \mathbb{E}[(X - \mathbb{E}[X])^2] = \mathbb{E}[X^2] - \mathbb{E}^2[X]$
 A prova será demonstrada mais adiante.

3. Identidade da Covariância

$Voc(X,Y) = \mathbb{E}[X*Y] - \mathbb{E}[X]*\mathbb{E}[Y] =  \mathbb{E}[(X -  \mathbb{E}[X])*(Y -  \mathbb{E}[Y])]$
Exercício para o leitor. Prove que isso é verdade.

4, Covariância é simétrica

$Cov(X,Y) = Cov(Y,X)$

5. Variância não é linear
 $Var(a*X + b) = a^2*Var(x)$

 6. Covariância não é linear

 $Cov(a*X + b,Y) = a*Cov(Y,X)$
# Prova da identidade da variância
Vamos mostrar que $\mathbb{E}[(X - \mathbb{E}[X])^2] = \mathbb{E}[X^2] - \mathbb{E}^2[X]$

1. Começamos expandido o quadrado da esperança:
$Var(X) = \mathbb{E}[(X - \mathbb{E}[X])^2] = \mathbb{E}[(X - \mathbb{E}[X]) * (X - \mathbb{E}[X])]$.

2. Aplicando a regra do quadrado, temos:
$\mathbb{E}[(X - \mathbb{E}[X]) * (X - \mathbb{E}[X])] = \mathbb{E}[(X^2 - 2* \mathbb{E}[X]*X + \mathbb{E}[X]^2)]$

3. Pela propriedade da experança, sabemos que, sejam $A$ e $B$ duas v.a. independentes, então $\mathbb{E}[A + B] = \mathbb{E}[A] + \mathbb{E}[B]$. Então:

$Var(X) = \mathbb{E}[X^2] - \mathbb{E}[2*\mathbb{E}[X]*X] + \mathbb{E}[\mathbb{E}[X]^2]]$

4. Outra propriedade da esperança é que, seja $a$ uma constante e $X$ uma v.a., então $\mathbb{E}[a*X] = a*\mathbb{E}[X]$.


$Var(X) = \mathbb{E}[X^2] - 2*\mathbb{E}[\mathbb{E}[X]*X] + \mathbb{E}[\mathbb{E}[X]^2]]$

5. Nós sabemos que $\mathbb{E}[X]$ é uma constante (é uma média da v.a.). E a média de uma constante é a própria constante. Portanto, $\mathbb{E}[\mathbb{E}[X]] = \mathbb{E}[X]$. E usaremos também que $\mathbb{E}[a*X] = a*\mathbb{E}[X]$ e, por fim, o fato de que uma constante ao quadrado é em si uma constante.

$Var(X) = \mathbb{E}[X^2] - 2*\mathbb{E}[X] * \mathbb{E}[\mathbb{E}[X]] + \mathbb{E}[X]^2]$

$Var(X) = \mathbb{E}[X^2] - 2*\mathbb{E}[X] * \mathbb{E}[X] + \mathbb{E}[X]^2]$

$Var(X) = \mathbb{E}[X^2] - 2*\mathbb{E}[X]^2 + \mathbb{E}[X]^2]$

$Var(X) = \mathbb{E}[X^2] - \mathbb{E}[X]^2$

Como Queriamos Demonstrar (CQD).



## Distribuição de Probabilidade Conjunta

A Distribuição de probabilidade conjunta de $X$ e $Y$ (definida no mesmo espaço de probabilidade) é uma distribuição de probabilidade dos pares $(x,y)$ e descreve como os valores de $X$ e $Y$ variam conjuntamente. Cada uma das distribuições $X$ e $Y$ sozinhas são chamadas de distribuições marginais. Uma distribuição conjunta é como uma máquina que, de acordo com certas regras de probabilidade, retorna dois pares de valores.

ex. 1.
Roleta. Em um casino, um jogo comum é a roleta. Ela consiste normalmente de 32 números (0 a 31), e cada número tem uma cor (preto, vermelho ou verde). Ao girar a roleta, ela solta um número e uma cor. Portanto, podemos pensar que a roleta é uma distribuição conjunta de duas variáveis (números e cores).

Ex. 2.:
Considere um dado de 4 faces $( 1, 2, 3, 4 )$. Seja $X$ a soma dos números dos dois dados, e $Y$ o maior valor dos dois dados. O espaço amostral é dado pela tabela abaixo.


```{r, results='asis', message=FALSE}
library(knitr)
library(dplyr)
library(kableExtra)
#Definir o espaço amostral

espaco_amostral <- expand.grid(1:4, 1:4)
espaco_amostral$X <- espaco_amostral$Var1 + espaco_amostral$Var2
espaco_amostral$Y <- pmax(espaco_amostral$Var1, espaco_amostral$Var2)

# Criar a tabela
kable(espaco_amostral, col.names = c("resultado do primeiro dado", "resultado do segundo dado", "X", "Y"),
                caption = "Tabela 2.5: Tabela representando a soma (X) and o maior valor (Y) do lançamento de dois dados de quatro lados") %>%
 kable_styling(bootstrap_options = "striped")


```

Se supusermos que todos os números possuem a mesma chance de sair quando jogamos os dados, então, a distribuição conjunta de $X$ e $Y$ pode ser dada por:

```{r, results='asis'}
library(knitr)
library(kableExtra)

# Definir os valores de (x, y) e P(X = x, Y = y)
valores <- c("(2, 1)", "(3, 2)", "(4, 2)", "(4, 3)", "(5, 3)", "(5, 4)", "(6, 3)", "(6, 4)", "(7, 4)", "(8, 4)")
probabilidades <- c(0.0625, 0.1250, 0.0625, 0.1250, 0.1250, 0.1250, 0.0625, 0.1250, 0.1250, 0.0625)

# Criar a tabela
tabela <- data.frame("(x, y)" = valores, "P(X = x, Y = y)" = probabilidades)

# Formatar a tabela
kable(tabela, caption = "Tabela 2.26: Tabela representando a distribuição conjunta da soma (X) e o maior (Y) de dois lançamentos de um dado de quatro faces",
                          col.names = c("$(X,Y)$", "$P(X=x, Y=y)$")) %>%
  kable_styling(bootstrap_options = "striped")


```

<!--chapter:end:03-revisão-stat.Rmd-->

